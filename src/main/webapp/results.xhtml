<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/WEB-INF/templates/mainTemplate.xhtml"
    xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

	<ui:define name="pageTitle">Results</ui:define>
	
	<ui:define name="css">
		<h:outputStylesheet library="css" name="index.css" />
	</ui:define>
	
	<ui:define name="content">
	<br/>
	<p:growl id="msgs" showDetail="true" />
    <h3 style="margin-top:0">Results for  <h:outputText value="#{resultsView.query}" /> </h3>
		<h:form>
		    <p:dataTable id="tbl" var="mutation" value="#{resultsView.mutations}"
		                 paginatorTemplate="{Exporters}"
		                 paginator="true" rows="25" style="margin-bottom:20px">
		 
		        <f:facet name="{Exporters}">
		            <h:commandLink>
		                <p:graphicImage library="img" name="excel.png" width="24"/>
		                <p:dataExporter type="xls" target="tbl" fileName="mutations" />
		            </h:commandLink>
		 		
		            <h:commandLink>
		                <p:graphicImage library="img" name="pdf.png" width="24"/>
		                <p:dataExporter type="pdf" target="tbl" fileName="mutations"/>
		            </h:commandLink>
		 
		            <h:commandLink>
		                <p:graphicImage library="img" name="csv.png" width="24"/>
		                <p:dataExporter type="csv" target="tbl" fileName="mutations" />
		            </h:commandLink>
		 
		            <h:commandLink>
		                <p:graphicImage library="img" name="xml.png" width="24"/>
		                <p:dataExporter type="xml" target="tbl" fileName="mutations" />
		            </h:commandLink>
		        </f:facet>
		 
		        <p:column>
		            <f:facet name="header">
		                <h:outputText id="Id" value="Id" />
    					<p:tooltip id="toolTipId" for="Id" value="Database identifier for each variant." />		                
		            </f:facet>
		            <h:outputLink value="variant.xhtml?id=#{mutation.eventId}">
						<h:outputText value="#{mutation.eventId}" />
					</h:outputLink>		            
		        </p:column>
 
		 
		        <p:column>
		            <f:facet name="header">
		                <h:outputText id="Gene" value="Gene"/>
		                <p:tooltip id="toolTipGene" for="Gene" value="Gene symbol on which the variant is located" />
		            </f:facet>
					
		            <center> 
		            	<ui:repeat var="g" value="#{mutation.annovar.genes}" varStatus="status">   
		            		<h:outputText value="#{g.symbol}" /> &nbsp;		            		
		            		
				            <ui:repeat var="x" value="#{g.xrefs.toArray()}">
				            	<h:outputLink target="_blank" value="http://exac.broadinstitute.org/gene/#{fn:substringAfter(x, 'Ensembl:') }">		                
				            		<h:graphicImage border="5"  library="img" name="exac.png" height="10" rendered="#{fn:startsWith(x,'Ensembl:')}" />
				           		</h:outputLink>
				           		<h:outputText rendered="#{fn:startsWith(x,'Ensembl:')}" value="&nbsp;&nbsp;"/>
				           		
					            <h:outputLink target="_blank" value="http://GRCH37.ensembl.org/Homo_sapiens/Gene/Summary?db=core;g=#{fn:substringAfter(x, 'Ensembl:') }">		                
					            	<h:graphicImage border="5"  library="img" name="ensembl.png" height="15" rendered="#{fn:startsWith(x,'Ensembl:')}" />
					            </h:outputLink>
								<h:outputText rendered="#{fn:startsWith(x,'Ensembl:')}" value="&nbsp;&nbsp;"/>
					             
				            </ui:repeat>
				            
		            		<h:outputLink target="_blank" value="http://www.ncbi.nlm.nih.gov/gene?cmd=search&amp;term=#{g.symbol}[sym]">		                
		            			<h:graphicImage border="5"  library="img" name="NCBI.gif" width="30"/>
		            		</h:outputLink>   
		            		
		            	</ui:repeat>
		            	
		            	
		            	
		             
		            
				
		            
		            
		            
		            <ui:remove>  
		             
		            
		            &nbsp;
		            
		            </ui:remove>
		            </center>
		            		 
		        </p:column>
		        		       
		        <p:column>
		            <f:facet name="header">
		                <h:outputText id="Sample" value="Sample"/>
		                <p:tooltip id="toolTipSample" for="Sample" value="Identifier for the proband tied to a cohort or group" />
		            </f:facet>
		            <h:outputText value="#{mutation.sampleId}" />		            
		        </p:column>
		        
		        <p:column>
		            <f:facet name="header">
		                <h:outputText id="REF" value="REF"/>
		                <p:tooltip id="toolTipREF" for="REF" value="Reference base(s) affected by the variant" />
		            </f:facet>
		            <h:outputText value="#{mutation.ref}" />
		        </p:column>
		        
		        <p:column>
		            <f:facet name="header">
		                <h:outputText id="ALT" value="ALT"/>
		                <p:tooltip id="toolTipALT" for="ALT" value="Modified base(s) caused by the variant" />
		            </f:facet>
		            <h:outputText value="#{mutation.alt}" />
		        </p:column>
		        
		         <p:column>
		            <f:facet name="header">
		                <h:outputText id="CHR" value="CHR"/>
		                <p:tooltip id="toolTipCHR" for="CHR" value="Chromosome affected by the variant" />
		            </f:facet>
		            <h:outputText value="#{mutation.chromosome}" />
		        </p:column>
		               
		        <p:column>
		            <f:facet name="header">
		                <h:outputText id="Start" value="Start"/>
		                <p:tooltip id="toolTipStart" for="Start" value="Start coordinate (inclusive) of the REF under Hg19" />
		            </f:facet>
		            <h:outputLink value="https://genome.ucsc.edu/cgi-bin/hgTracks?db=hg19&amp;position=chr#{mutation.chromosome}%3A#{mutation.startHg19}-#{mutation.stopHg19}">	
		            	<h:outputText value="#{mutation.startHg19}" />
		            </h:outputLink>	  
		        </p:column>
		        
		        <p:column>
		            <f:facet name="header">
		                <h:outputText id="Stop" value="Stop"/>
		            	<p:tooltip id="toolTipStop" for="Stop" value="Stop coordinate (inclusive) of the REF under Hg19" />	
		            </f:facet>
		            <h:outputLink value="https://genome.ucsc.edu/cgi-bin/hgTracks?db=hg19&amp;position=chr#{mutation.chromosome}%3A#{mutation.startHg19}-#{mutation.stopHg19}">			            
		            	<h:outputText value="#{mutation.stopHg19}" />
		            </h:outputLink>
		        </p:column>
		        
		        
		        <p:column>
		            <f:facet name="header">
		                <h:outputText id="Effect" value="Effect"/>
		                <p:tooltip id="toolTipEffect" for="Effect" value="Reported variant effect" />	
		           
		            </f:facet>
	            	
	            	<ui:repeat var="c" value="#{mutation.annovar.categories.toArray()}" varStatus="status">   
	            		<h:outputText value="#{c.label}" /> &nbsp;
	            		<h:outputText value="" rendered="#{not status.last}" /> 	            		          			            			          
	            	</ui:repeat>
	            	
		        </p:column>
		        
		        
		        <p:column>
		            <f:facet name="header">
		                <h:outputText id="Source" value="Source"/>
		                <p:tooltip id="toolTipSource" for="Source" value="Source where the variant is reported from" />		           
		            </f:facet>
		             <h:outputLink value="#{mutation.paper.url}">			            
		            	<h:outputText value="#{mutation.paper.author}" />
		            </h:outputLink>
		        </p:column>
		        
		        <p:column>
		            <f:facet name="header">
		                <h:outputText id="Occurences" value="Occurences"/>
		                <p:tooltip id="toolTipOccurences" for="Occurences" 
		                value="Number of time this mutation has been reported across different samples." />			           
		            </f:facet>
		            
		        </p:column>
		 
		    </p:dataTable>
		</h:form>
	</ui:define>

</ui:composition>