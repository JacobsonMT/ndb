<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/WEB-INF/templates/mainTemplate.xhtml"
    xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:hf="http://highfaces.org/ui"> 
	
	<ui:define name="pageTitle">Statistics</ui:define>

	<ui:define name="css">
		<h:outputStylesheet library="css" name="stats.css" />
	</ui:define>
	

	<ui:define name="js">
		<script src="https://code.highcharts.com/highcharts.js"></script>
		<script src="https://code.highcharts.com/modules/heatmap.js"></script>
		<script src="https://code.highcharts.com/modules/exporting.js"></script>
		<script type="text/javascript" language="javascript"
			src="resources/js/plugins/jqplot.logAxisRenderer.js"></script>
		<script src="resources/js/stats.js">
         
      </script>
      
      <script type="text/javascript">
		heatmap_data = #{statsView.heatmapModel.dataJSON};
		heatmap_papers = #{statsView.heatmapModel.categoriesJSON};
		heatmap_categories = heatmap_papers.map(function(paper) {
		   return paper.paper_key;
		});
		heatmap_paper_ids = heatmap_papers.map(function(paper) {
		   return paper.id;
		});
		
		goToPaperOverlap = function(paperId, overlapPaperId) {
		   var url = '#{request.contextPath}/variant.xhtml?paperId='+ paperId + '&amp;overlapPaperId=' + overlapPaperId;
		   window.open(url, '_blank');
		}
      </script>

	</ui:define>

	<ui:define name="content">
	
	<!-- BREADCRUMBS -->
	
	<p:panel styleClass="no-border" >
		<p:breadCrumb style="float:left;"> 
			<p:menuitem value="Categories" url="#" />
			<p:menuitem value="Home" url="index.xhtml" />
			<p:menuitem value="Statistics" url="stats.xhtml" />
		</p:breadCrumb>  	            
	</p:panel>
   
   <div class="content-area">
	
	<div class="section">

	<h3>Statistics</h3>
	
	<p:separator/>
	
	<p:panelGrid styleClass="no-border" columns="3" >
	
		
 	  	<p:panel styleClass="no-border">
		    	<ui:include src="stats_table_topdenovolof.xhtml"></ui:include>		    
   		</p:panel>	
    	
 	  	<p:panel styleClass="no-border">
 	  	<p> Typical usage of a genetic variant database may require counts of certain types of events. Herein, we present some summaries of the data collected through graphics and tabulations of counts.</p>
 	  	<p:panelGrid columns="2" style="margin:20px auto 20px auto;">
 	  	<f:facet name="header">
        	Database Statistics
    	</f:facet>	 	  	
        	<ui:include src="stat_summary.xhtml" />
 	  	</p:panelGrid>
 	  	
 	  	
 	  	<p>
 	  	A <em>Variant Event</em> is a specific mutation that occurred on a specific proband. This counts disambiguates instances where the same proband across different cohorts is assigned different identifiers. This also accounts for instances where certain publications will report a complex variant as two events (e.g. a deletion followed by an insertion), while others may opt to report it as one (a substitution.) Unless specificied otherwise, this is count we use to do other statistics about number of variants in this database. 
 	  	</p>
 	  	
 	  	<p>A <em>de novo</em> variant is a type of genetic mutation that was not inherited from a parent, but rather from a germ cell from a parent. 
 	  	Many <p:link outcome="publications" value="publications" target="_blank" /> primarily report de novo variants across whole genomes, exomes, or specific targeted genes.</p>
 	  	
 	  	<p><em>Loss of function</em> variants are DNA mutations that affects transcription of RNA in a way that the resulting amino acid sequence is unlikely to produce a functionally relevant protein.
 	  	These mutations are usually of the <em>frameshift</em> type, meaning an insertion (or deletion) of a block that is not a multiple of 3. This causes an offset to the codon reading frame. 
 	  	Other loss of function variants include splice site variants; mutations that occur within 2 bases of an exon, preventing it from being spliced into the transcript. Loss of function can also be attributed to mutations that disturb a stop codon with an amino acid change, or creates a new one prematurely.  
 	  	</p>
 	  	
 	  	</p:panel>
 	  	
 	  	<p:panel styleClass="no-border">
	  		<ui:include src="stats_table_topgenesbyeventcnt.xhtml"></ui:include>
    	<br/>
    		<ui:include src="stats_table_topgenesbypapercnt.xhtml"></ui:include>
	  	</p:panel>
 	  
    	
	</p:panelGrid>
	</div>
	

	
	<div class="section">
		<h3>Variants Events Per Paper</h3>
		<p:separator/>
		<p>
			The charts in this section describe the breakdown by origin for variants events included in this database. 
			The first chart shows the papers including the highest counts of variant events, while the second chart is a complete breakdown of all papers. 
		</p>
		<p:panelGrid columns="2" styleClass="no-border" style="margin: 0 auto;">				
		
			<p:chart type="pie" 
						model="#{statsView.compactPieModel}" 
						dataFormat="value"  
				 		showDataLabels="true" 
					 	style="width:800px;height:400px; " />
		
			<p:chart type="pie" 
						model="#{statsView.pieModel}" 
						dataFormat="value"  
				 		showDataLabels="true" 
					 	style="width:800px;height:400px; " />
				 	
		</p:panelGrid>		
	</div>
	


		<div class="section">
	<h3>Variant Categories</h3>
	<p:separator/>
		<p>
			Variants are reported with a <em>category</em> and a <em>function</em>. 
		</p>
			 
		<p>
			 The <em>category</em> describes the potential effect of this variant, such as synonymous and nonsynonymous single nucleotide variant (SNV), or changes in the reading frame (e.g. frameshift insertions, deletions, substitutions).  			 
  			 The <em>function</em> represents the functional role of the area where the variant originated from (e.g. A variant from non-coding DNA would be labeled as <em>intronic.</em> ) The y-axis is log-scaled to facilitate readability. 
		</p>

		<p:panelGrid columns="2" styleClass="no-border" style="margin: 0 auto;">
			<p:chart type="bar" model="#{statsView.variantCategoriesBarModel}" style="width:800px;height:500px;"/>		
			<p:chart type="bar" model="#{statsView.variantFuncBarModel}" style="width:800px;height:500px;" logYAxis="true" />		
		</p:panelGrid>
		
				
	</div>
	
	<div class="section">
		
	<h3>Variant Event Overlap</h3>
	<p:separator/>
	
	<div id="heatmapText">
		<p>
			The map below represents the overlap between variant events reported by different papers. The diagonal represents the total number of reported variant events included in this database originating from a given paper.
		</p>
		
	</div>
	<div id="heatmap-container" style="height: 1000px; width: 80%; margin: 0 auto;"
	></div>
	</div>
	

	<h4> More information / Contact us</h4>	
	<div id="concludingText" style="width: 80%; margin: 0 auto; margin-left: 50px; ">
		<p>
				For more information about our data curation and harmonization, visit the <a href="documentation.xhtml">documentation</a> section. For any questions or comments, feel free to contact <a href="mailto:#{applicationProperties.getProperty('ndb.email')}">#{applicationProperties.getProperty('ndb.email')}</a>.  			
		</p>		
		
	</div>
	
	</div>
	
	</ui:define>

</ui:composition>
